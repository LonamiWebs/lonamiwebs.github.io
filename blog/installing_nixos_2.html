<!DOCTYPE html>
<html>
<head>
    <title>Installing NixOS, Take 2</title>
    <link rel="stylesheet" type="text/css" href="styles/main.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
    <div class="minMargin">
    <div class="card">
        <h1>Installing NixOS, Take 2</h1>
        <p class="right"><em>Written by
        <a href="https://lonamiwebs.github.io">Imanol H.</a><br />
        the 15-02-2019. Last revision the 15-02-2019</em></p>
        <hr />
        <p>This is my second take at installing NixOS, after
        a while being frustrated with Arch Linux and the fact
        that a few kernel upgrades ago, the system crashed
        randomly from time to time. <code>journalctl</code>
        did not have any helpful hints and I thought reinstalling
        could be worthwhile anyway.</p>

        <p>This time, I started with more knowledge! The first step
        is heading to the <a href="https://nixos.org">NixOS website</a>
        and downloading their minimal installation CD for 64 bits.
        I didn't go with their graphical live CD, because their
        <a href="https://nixos.org/nixos/manual">installation manual</a>
        is a wonderful resource that guides you nicely.</p>

        <p>Once you have downloaded their <code>.iso</code>, you
        should probably verify it's <code>sha256sum</code> and make
        sure that it matches. The easiest thing to do in my opinion
        is using an USB to burn the image in it. Plug it in and check
        its device name with <code># fdisk -l</code>. In my case, it
        was <code>/dev/sdb</code>, so I went ahead with it and ran
        <code># dd if=nixos.iso of=/dev/sdb status=progress</code>.
        Make sure to run <code>sync</code> once that's done.</p>

        <p>Now, reboot your computer with the USB plugged in
        and make sure to boot into it. You should be welcome
        with a pretty screen. Just select the first option and
        wait until it logs you in as root. Once you're there
        you probably want to <code>loadkeys es</code> or whatever
        your keyboard layout is, or you will have a hard time with
        passwords, since the characters are all over the place.</p>

        <p>In a clean disk, you would normally create the partitions
        now. In my case, I already had the partitions made (100MB for
        the EFI system, where <code>/boot</code> lives, 40GB for the
        root <code>/</code> partition with my old Linux installation,
        and 700G for <code>/home</code>), so I didn't need to do anything
        here. The manual showcases <code>parted</code>, but I personally
        use <code>fdisk</code>, which has very helpful help I check every
        time I use it.</p>

        <p><strong>Important</strong>: The <code>XY</code> in
        <code>/dev/sdXY</code> is probably different in your system!
        Make sure you use <code>fdisk -l</code> to see the correct
        letters and numbers!</p>

        <p>With the partitions ready in my UEFI system, I formatted both
        <code>/</code> and <code>/boot</code> just to be safe with
        <code>mkfs.ext4 -L nixos /dev/sda2</code> and
        <code>mkfs.fat -F 32 -n boot /dev/sda1</code> (remember that
        these are the letters and numbers used in my partition scheme).
        Don't worry about the warning in the second command regarding
        lowercase letters and Windows. It's not really an issue.</p>

        <p>Now, since we gave each partition a label, we can easily
        mount them through <code>mount /dev/disk/by-label/nixos /mnt</code>
        and, in UEFI systems, be sure to <code>mkdir -p /mnt/boot</code>
        and <code>mount /dev/disk/by-label/boot /mnt/boot</code>. I
        didn't bother setting up swap, since I have 8GB of RAM in my
        laptop and that's really enough for my use case.</p>

        <p>With that done, we will now ask the configuration wizard
        to do some work for us (in particular, generate a template) with
        <code>nixos-generate-config --root /mnt</code>. This generates
        a very well documented file that we should edit right now (and
        this is important!) with whatever editor you prefer. I used
        <code>vim</code>, but you can change it for <code>nano</code>
        if you prefer.</p>

        <p>On to the configuration file, we need to enable a few things,
        so <code>vim /mnt/etc/nixos/configuration.nix</code> and start
        scrolling down. We want to make sure to uncomment:</p>

<pre># We really want network!
networking.wireless.enable = true;

# This "fixes" the keyboard layout. Put the one you use.
i18n = {
  consoleKeyMap = "es";
}

# Timezones are tricky so let's get this right.
time.timeZone = "Europe/Madrid";

# We *really* want some base packages installed, such as
# wpa_supplicant, or we won't have a way to connect to the
# network once we install...
environment.systemPackages = with pkgs; [
  wpa_supplicant wget curl vim neovim cmus mpv firefox git tdesktop
];

# We want the X11 windowing system enabled, in Spanish.
services.xserver.enable = true;
services.xserver.layout = "es";

# I want a desktop manager in my laptop.
# I personally prefer XFCE, but the manual shows plenty
# of other options, such as Plasma, i3 WM, or whatever.
services.xserver.desktopManager.xfce.enable = true;
services.xserver.desktopManager.default = "xfce";
</pre>

        <p>If there's something I overlooked or that could be done better,
        or maybe you can explain it differently, please be sure to
        <a href="https://lonamiwebs.github.io/contact">contact me</a>
        to let me know!</p>

        <p>More to come when I have more time...</p>

		<p><a href="index">Back to the index</a></p>
    </div>
    </div>
</body>
</html>
